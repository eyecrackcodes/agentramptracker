generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  relationMode = "foreignKeys"
}

model Team {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  agents      Agent[]
}

model Agent {
  id              String   @id @default(cuid())
  firstName       String
  lastName        String
  email           String   @unique
  teamId          String
  team            Team     @relation(fields: [teamId], references: [id])
  startDate       DateTime
  status          String?  @default("P") // "P" for Performance queue, "T" for Training queue, "A" for Archived
  tenure          Float?   // Tenure in months
  targetLeadsPerDay Int    @default(8)
  metrics         Metric[]
  coachingSessions CoachingSession[]
  callScores      CallScore[]
  developmentGoals DevelopmentGoal[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Metric {
  id              String   @id @default(cuid())
  agentId         String
  agent           Agent    @relation(fields: [agentId], references: [id])
  year            Int
  month           Int
  week            Int
  closeRate       Float
  averagePremium  Float
  placeRate       Float
  capScore        Float
  leadsPerDay     Float
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([agentId, year, month, week])
}

model CoachingSession {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id    String   @db.Uuid
  date        DateTime @db.Timestamptz
  type        String   @db.VarChar(50)
  notes       String   @db.Text
  action_items String? @db.Text
  created_at  DateTime @default(now()) @db.Timestamptz
  updated_at  DateTime @default(now()) @db.Timestamptz
  agent       Agent    @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@map("coaching_sessions")
}

model CallScore {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id         String   @db.Uuid
  date             DateTime @db.Timestamptz
  call_type        String   @db.VarChar(50)
  customer_service Int
  sales_approach   Int
  call_control     Int
  notes            String?  @db.Text
  created_at       DateTime @default(now()) @db.Timestamptz
  updated_at       DateTime @default(now()) @db.Timestamptz
  agent            Agent    @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@map("call_scores")
}

model DevelopmentGoal {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id    String   @db.Uuid
  goal_type   String   @db.Text
  description String   @db.Text
  target_date DateTime @db.Timestamp()
  status      String   @db.Text
  progress    String?  @db.Text
  created_at  DateTime @default(now()) @db.Timestamp()
  updated_at  DateTime @default(now()) @db.Timestamp()
  agent       Agent    @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@map("development_goals")
}

// Legacy models - keeping for reference but not using in new code
// model User {
//   id        String            @id @default(cuid())
//   clerkId   String            @unique
//   email     String            @unique
//   role      UserRole          @default(AGENT)
//   team      String?
//   class     String?
//   startDate DateTime
//   createdAt DateTime          @default(now())
//   updatedAt DateTime          @updatedAt
//   metrics   AgentRampMetric[]
// }

// model AgentRampMetric {
//   id               String   @id @default(cuid())
//   userId           String
//   monthNumber      Int
//   weekNumber       Int
//   closeRate        Float
//   avgPremium       Float
//   placeRate        Float
//   capScore         Float?
//   leadsTakenPerDay Float
//   createdAt        DateTime @default(now())
//   updatedAt        DateTime @updatedAt
//   user             User     @relation(fields: [userId], references: [id])

//   @@unique([userId, monthNumber, weekNumber])
// }

// enum UserRole {
//   ADMIN
//   AGENT
// }
